clear

testname = 'sofa';
set = 'livingroom';
%%
img_dir = fullfile('../Data_Collection', set);
resize_img_dir = fullfile(img_dir, 'resized');
datadir = fullfile('./data/rooms', set);
outdir = fullfile(fullfile('./tempdata/detection', set), testname);
%%
addPaths();
addVarshaPaths();

datafiles = dir(fullfile(datadir, '*.mat'));
for i = 1:length(datafiles)
    fname = getfname(datafiles(i).name);
    try
        img = imread(fullfile(img_dir, [fname '.jpg']));
    catch ee
        img = imread(fullfile(img_dir, [fname '.JPEG']));
    end
    data1 = load(fullfile(datadir, datafiles(i).name), 'room', 'objs', 'gtPolyg');
    data2 = load(fullfile(outdir, fname), 'dobjs');
    
    ShowGTPolyg(img, data1.gtPolyg, 10);
    
    drawCube(data1.room, data1.gtPolyg);    
    
    objs = data2.dobjs;
    for j = 1:length(objs)
        include_indices(j) = false;
        (sum(sum(isnan(objs(j).cube))) > 0 || sobjs(j)(3, :) < 0);
    end
    drawObjects(data1.room, {objs(include_indices)}, objmodels(), 20, 10);
end